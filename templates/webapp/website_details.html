{% extends 'webapp/base.html' %}
{% load staticfiles %}
{% load crispy_forms_tags %}

{% block title_block %}
    {{ website.name }}
{% endblock %}

{% block body_block %}
    <div id="rating_success" class="alert alert-success collapse" role="alert">
        <button type="button" class="close">
            <span aria-hidden="true">&times;</span>
        </button>
        <strong>Thank you for your feedback!</strong> The rating has been updated.
    </div>
    <div id="rating_error" class="alert alert-danger collapse" role="alert">
        <button type="button" class="close">
            <span aria-hidden="true">&times;</span>
        </button>
        <strong>Something went wrong.</strong> The rating could not been updated.
    </div>

    <div class="row">
        <div class="col-6">
            <h2>{{ website.name }}</h2>
            <h4><a href="{{ website.url }}">{{ website.url }}</a></h4>
            <p><strong>Description:</strong></p>
            <p>{{ website.description }}</p>
            <p><strong>Published on:</strong></p>
            <p>{{ website.published }}</p>
            <p><strong>Thumbnail:</strong></p>
            <p>
            {% if website.thumbnail%}
                <img height="100%" src="{{ website.thumbnail.url }}" alt="Webstie thumbnail"/>
            {% else %}
                <img height="100%" src="https://dummyimage.com/600x400/ffffff/727596.png&text=No+thumbnail+available" alt="No thumbnail available"/>
            {% endif %}
            </p>
        </div>
        <div class="col-6">
            <h3>Average rating<h3>
            <h4><span id="average_rating">{{ website.average_rating }}</span>/5</h4>
            
            {% if user.is_authenticated and user == website.owner %}
            <div>You cannot rate your own website.</div>
            {% elif user.is_authenticated %}
            <div class='rating-stars text-center'>
                <ul id='stars'>
                    <li class='star' title='Terrible' data-value='1'><i class='fa fa-star fa-fw'></i></li>
                    <li class='star' title='Bad' data-value='2'><i class='fa fa-star fa-fw'></i></li>
                    <li class='star' title='Average' data-value='3'><i class='fa fa-star fa-fw'></i></li>
                    <li class='star' title='Good' data-value='4'><i class='fa fa-star fa-fw'></i></li>
                    <li class='star' title='Excellent' data-value='5'><i class='fa fa-star fa-fw'></i></li>
                </ul>
            </div>  
            {% else %}
            <div>You have to be logged in to rate websites.</div>
            {% endif %}

            {% if ratings %}
            <h4>Latest ratings:</h4>
            <div id="latest_ratings">
                {% for rating in ratings %}
                    <div class="card">
                        Rating: {{ rating.rating }}
                        <br>
                        User: {{ rating.user }}
                    </div>
                {% endfor %}
                {% else %}
                    <h4>No ratings so far. Be the first to rate this website!</h4>
                {% endif %}
            </div>
        </div>
    </div>
    <div class="row">
        {% if comment_form %}
        <h4>Post comment:</h4>
        <form method="post">
            {% csrf_token %}
            {{ comment_form|crispy }}
            <button class="btn btn-primary" type="submit">Post comment</button>
        </form>
        {% else %}
        <div>You have to be logged in to comment.</div>
        {% endif %}
    </div>

    {% if comments %}
    <h4>Comments:</h4>
    {% for comment in comments %}
        <div class="card row">
            <h5>{{ comment.title }}</h5>
            <p>{{ comment.text }}</p>
            <p>Published on: {{ comment.published }} by {{ comment.user }}</p>
        </div>
    {% endfor %}
    {% else %}
        <h4>No comments so far. Be the first one!</h4>
    {% endif %}
{% endblock %}

{% block script_block %}
    <script type="text/javascript">
        var rating_ajax_url = '{% url "website_update_rating" website.slug %}';
        var csrf_token = '{{ csrf_token }}';
        var current_rating = {{ current_rating }};
    </script>
    <script src="{% static "js/website_detail.js" %}" type="text/javascript"></script>
{% endblock %}